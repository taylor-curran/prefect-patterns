# Welcome to your prefect.yaml file! You can you this file for storing and managing
# configuration for deploying your flows. We recommend committing this file to source
# control along with your flow code.

# Generic metadata about this project
name: prefect-patterns
prefect-version: 2.10.17

# build section allows you to manage and build docker images
build:
- prefect.deployments.steps.run_shell_script:
    id: get-commit-hash
    script: git rev-parse --short HEAD
    stream_output: false
- prefect_docker.deployments.steps.build_docker_image:
    requires: prefect-docker>=0.3.0
    image_name: taycurran/test-projects-june11
    tag: '{{ get-commit-hash.stdout }}'
    dockerfile: auto
    push: true

# push section allows you to manage if and how this project is uploaded to remote locations
push:

# pull section allows you to provide instructions for cloning this project in remote locations
pull:
- prefect.deployments.steps.git_clone:
    repository: https://github.com/taylor-curran/prefect-patterns.git
    branch: main

definitions:
  tags:
  - subflow-patterns
  work_pool: &local_docker
    name: local-docker
    job_variables:
      image: '{{ image }}'

# the deployments section allows you to provide configuration for deploying flows
deployments:
- name: a-local-docker
  version:
  tags:
  - docker
  - child
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/tasks_subflows_models/child_flows_sync.py:child_flow_a
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: b-local-docker
  version:
  tags:
  - docker
  - child
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/tasks_subflows_models/child_flows_sync.py:child_flow_b
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: c-local-docker
  version:
  tags:
  - docker
  - child
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/tasks_subflows_models/child_flows_sync.py:child_flow_c
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: d-local-docker
  version:
  tags:
  - docker
  - child
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/tasks_subflows_models/child_flows_sync.py:child_flow_d
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: jtc-local-docker
  version:
  tags:
  - docker
  - parent
  - just-tasks
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/control_just_tasks_concurrent.py:just_tasks_concurrent
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: jts-local-docker
  version:
  tags:
  - docker
  - parent
  - just-tasks
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: flows/composite_flow_patterns/control_just_tasks_sync.py:just_tasks_sync
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: twd-local-docker
  version:
  tags:
  - docker
  - parent
  - task-wrapped-deployments
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/task_wrapped_deployments.py:task_wrapped_deployments
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: agsf-local-docker
  version:
  tags:
  - docker
  - parent
  - asyncio-gather
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/asyncio_gather_subflows.py:asyncio_gather_sub_flows
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: bsf-local-docker
  version:
  tags:
  - docker
  - parent
  - blocking-subflows
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: flows/composite_flow_patterns/blocking_subflows.py:blocking_subflows
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: agsd-local-docker
  version:
  tags:
  - docker
  - parent
  - asyncio-gather
  - sub-deployments
  - '{{ get-commit-hash.stdout }}'
  description:
  entrypoint: 
    flows/composite_flow_patterns/asyncio_gather_sub_deployments.py:asyncio_gather_sub_deployments
  parameters: {}
  work_pool: *local_docker
  schedule:
- name: sd-local-docker
  version:
  tags:
  - docker
  - parent
  - sub-deployments
  - '{{ get-commit-hash.stdout }}'
  description: description
  entrypoint: flows/composite_flow_patterns/sub_deployments.py:sub_deployments
  parameters: {}
  work_pool: *local_docker
  schedule: